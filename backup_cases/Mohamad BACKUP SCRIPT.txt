-- Author: 	Hussain refaa
-- creation Date: 	2008
-- Last Updated: 	0000-00-00
-- Control Number:	xxxx-xxxx-xxxx-xxxx
-- Version: 	0.0
-- Phone : +4915775148443
-- Email: hus244@gmail.com


SQL> alter database archivelog;

RMAN> CONFIGURE CONTROLFILE AUTOBACKUP ON;
RMAN> CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO 'C:\TEMP3\CF%F';
RMAN> CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   'C:\temp3\%U';

RMAN> BACKUP DATABASE PLUS ARCHIVELOG;

CMD> SET ORACLE_SID=X1

RMAN> SHUTDOWN IMMEDIATE;

RMAN> SET DBID = 2706257527

RMAN> STARTUP NOMOUNT;

RMAN> RUN
 {
 SET CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO 'C:\TEMP\CF%F';
 RESTORE SPFILE TO PFILE 'E:\X2.ORA' FROM AUTOBACKUP;
 }

---CHANGE PATH IN THE SPFILE

SHUTDOWN IMMEDIATE;

STARTUP NOMOUNT PFILE = 'E:\X2.ORA';


RMAN> RUN
 {
 SET CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO 'C:\TEMP\CF%F';
 RESTORE CONTROLFILE FROM AUTOBACKUP;
 ALTER DATABASE MOUNT;
 }



SQL> SELECT FILE# AS "File/Grp#", NAME FROM V$DATAFILE
UNION
SELECT GROUP#,MEMBER FROM V$LOGFILE;


RMAN> RUN
 {
 ALLOCATE CHANNEL c1 DEVICE TYPE DISK FORMAT = 'C:\TEMP\%U';
 SET NEWNAME FOR DATAFILE 1 TO 'C:\oracle\product\10.2.0\oradata\x1\system01.dbf';
 SET NEWNAME FOR DATAFILE 2 TO 'C:\oracle\product\10.2.0\oradata\x1\undotbs01.dbf';
 SET NEWNAME FOR DATAFILE 3 TO 'C:\oracle\product\10.2.0\oradata\x1\SYSAUX01.dbf';
 SET NEWNAME FOR DATAFILE 4 TO 'C:\oracle\product\10.2.0\oradata\x1\USERS01.dbf';
 SQL "ALTER DATABASE RENAME FILE ''E:\oracle\product\10.2.0\oradata\x1\REDO01.LOG'' TO ''C:\oracle\product\10.2.0\oradata\x1\REDO01.LOG'' ";
 SQL "ALTER DATABASE RENAME FILE ''E:\oracle\product\10.2.0\oradata\x1\REDO02.LOG'' TO ''C:\oracle\product\10.2.0\oradata\x1\REDO02.LOG'' ";
 SQL "ALTER DATABASE RENAME FILE ''E:\oracle\product\10.2.0\oradata\x1\REDO03.LOG'' TO ''C:\oracle\product\10.2.0\oradata\x1\REDO03.LOG'' ";
 RESTORE DATABASE;
 SWITCH DATAFILE ALL;
 RECOVER DATABASE;
 }


RUN
 {
 ALLOCATE CHANNEL c1 DEVICE TYPE DISK FORMAT = 'Z:\%U';
 RESTORE DATABASE;
 SWITCH DATAFILE ALL;
 RECOVER DATABASE;
 }
